{% extends 'admin/base.html' %}

{% block title %}Support Tickets | Golden Mais{% endblock %}

{% block content %}
<div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8">
    <div>
        <p class="text-sm uppercase tracking-wide text-gray-400 font-semibold">Support Operations</p>
        <h1 class="text-3xl font-bold text-gray-900">Support Tickets</h1>
        <p class="text-gray-500 text-sm">Monitor conversations and keep customers informed in real time.</p>
    </div>
</div>

<!-- Stats -->
<div class="floating-section rounded-2xl p-4 mb-8 grid grid-cols-1 md:grid-cols-4 gap-4">
    <div class="bg-white rounded-2xl border border-gray-100 shadow-sm p-5 flex items-center">
        <div class="p-3 rounded-2xl bg-blue-50 text-blue-600">
            <i class="fas fa-ticket-alt text-xl"></i>
        </div>
        <div class="ml-4">
            <p class="text-xs uppercase text-gray-400 font-semibold">Total Tickets</p>
            <p class="text-2xl font-bold text-gray-900">{{ stats.total_tickets }}</p>
        </div>
    </div>
    <div class="bg-white rounded-lg shadow p-5 flex items-center">
        <div class="p-3 rounded-full bg-red-100 text-red-600">
            <i class="fas fa-fire text-xl"></i>
        </div>
        <div class="ml-4">
            <p class="text-sm text-gray-500">Open</p>
            <p class="text-2xl font-semibold text-gray-900">{{ stats.open_tickets }}</p>
        </div>
    </div>
    <div class="bg-white rounded-lg shadow p-5 flex items-center">
        <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
            <i class="fas fa-spinner text-xl"></i>
        </div>
        <div class="ml-4">
            <p class="text-sm text-gray-500">In Progress</p>
            <p class="text-2xl font-semibold text-gray-900">{{ stats.in_progress_tickets }}</p>
        </div>
    </div>
    <div class="bg-white rounded-lg shadow p-5 flex items-center">
        <div class="p-3 rounded-full bg-green-100 text-green-600">
            <i class="fas fa-check-circle text-xl"></i>
        </div>
        <div class="ml-4">
            <p class="text-sm text-gray-500">Resolved</p>
            <p class="text-2xl font-semibold text-gray-900">{{ stats.resolved_tickets }}</p>
        </div>
    </div>
</div>

<!-- Filters -->
<div class="bg-white rounded-2xl border border-gray-100 shadow-sm p-5 mb-6">
    <form method="get" class="grid grid-cols-1 md:grid-cols-3 gap-5">
        <div>
            <label class="text-sm font-medium text-gray-600">Status</label>
            <select name="status" class="mt-1 w-full border rounded px-3 py-2 focus:ring-yellow-500 focus:border-yellow-500" onchange="this.form.submit()">
                <option value="">All</option>
                <option value="open" {% if status_filter == 'open' %}selected{% endif %}>Open</option>
                <option value="in_progress" {% if status_filter == 'in_progress' %}selected{% endif %}>In Progress</option>
                <option value="resolved" {% if status_filter == 'resolved' %}selected{% endif %}>Resolved</option>
                <option value="closed" {% if status_filter == 'closed' %}selected{% endif %}>Closed</option>
            </select>
        </div>
        <div>
            <label class="text-sm font-medium text-gray-600">Priority</label>
            <select name="priority" class="mt-1 w-full border rounded px-3 py-2 focus:ring-yellow-500 focus:border-yellow-500" onchange="this.form.submit()">
                <option value="">All</option>
                <option value="low" {% if priority_filter == 'low' %}selected{% endif %}>Low</option>
                <option value="medium" {% if priority_filter == 'medium' %}selected{% endif %}>Medium</option>
                <option value="high" {% if priority_filter == 'high' %}selected{% endif %}>High</option>
                <option value="urgent" {% if priority_filter == 'urgent' %}selected{% endif %}>Urgent</option>
            </select>
        </div>
        {% if status_filter or priority_filter %}
            <div class="flex items-end">
                <a href="{% url 'admin_support_dashboard' %}" class="w-full text-center bg-gray-100 border border-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-200">Clear Filters</a>
            </div>
        {% endif %}
    </form>
</div>

<!-- Tickets Table -->
<div class="bg-white rounded-2xl border border-gray-100 shadow-sm overflow-hidden">
    <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-100">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ticket</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Assigned</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Updated</th>
                    <th class="px-6 py-3"></th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                {% for ticket in tickets %}
                <tr class="hover:bg-gray-50 transition">
                    <td class="px-6 py-4">
                        <p class="text-sm font-semibold text-gray-900">#{{ ticket.ticket_number }}</p>
                        <p class="text-sm text-gray-600">{{ ticket.subject }}</p>
                    </td>
                    <td class="px-6 py-4">
                        <p class="text-sm text-gray-900">{{ ticket.customer.user.get_full_name|default:ticket.customer.user.username }}</p>
                        <p class="text-xs text-gray-500">{{ ticket.customer.user.email }}</p>
                    </td>
                    <td class="px-6 py-4">
                        {% if ticket.priority == 'urgent' %}
                            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700">Urgent</span>
                        {% elif ticket.priority == 'high' %}
                            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-orange-100 text-orange-700">High</span>
                        {% elif ticket.priority == 'medium' %}
                            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-700">Medium</span>
                        {% else %}
                            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-700">Low</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4">
                        {% if ticket.status == 'open' %}
                            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700">Open</span>
                        {% elif ticket.status == 'in_progress' %}
                            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-700">In Progress</span>
                        {% elif ticket.status == 'resolved' %}
                            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-700">Resolved</span>
                        {% else %}
                            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-700">Closed</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-700">
                        {% if ticket.assigned_to %}
                            {{ ticket.assigned_to.get_full_name|default:ticket.assigned_to.username }}
                        {% else %}
                            <span class="text-gray-400">Unassigned</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-500">
                        {{ ticket.updated_at|timesince }} ago
                    </td>
                    <td class="px-6 py-4 text-right">
                        <a href="{% url 'admin_ticket_detail' ticket.ticket_number %}" class="inline-flex items-center px-3 py-2 text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700">
                            <i class="fas fa-eye mr-2"></i>View
                        </a>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="px-6 py-16 text-center text-gray-400 text-sm">
                        <div class="flex flex-col items-center">
                            <div class="w-12 h-12 rounded-full bg-gray-100 flex items-center justify-center mb-3">
                                <i class="fas fa-headset text-xl text-gray-400"></i>
                            </div>
                            <p>No support tickets found.</p>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
