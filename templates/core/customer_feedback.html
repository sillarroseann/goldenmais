{% extends 'base.html' %}
{% load static %}

{% block title %}Customer Feedback | Golden Mais{% endblock %}

{% block content %}
<!-- Header -->
<section class="py-12 px-8 bg-blue-50">
    <div class="max-w-4xl mx-auto">
        <div class="flex items-center space-x-4 mb-4">
            <a href="{% url 'customer_support' %}" class="text-blue-600 hover:text-blue-800">
                <i class="fas fa-arrow-left text-xl"></i>
            </a>
            <h1 class="text-3xl font-bold text-blue-800">Customer Feedback</h1>
        </div>
        <p class="text-gray-600">Help us improve by sharing your experience with Golden Mais</p>
    </div>
</section>

<!-- Feedback Form -->
<section class="py-16 px-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-lg shadow-md p-8">
            <form method="post" class="space-y-6">
                {% csrf_token %}
                
                <!-- Feedback Type -->
                <div>
                    <label for="feedback_type" class="block text-sm font-medium text-gray-700 mb-2">
                        Feedback Type <span class="text-red-500">*</span>
                    </label>
                    <select id="feedback_type" 
                            name="feedback_type" 
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="general">General Feedback</option>
                        <option value="product">Product Feedback</option>
                        <option value="service">Service Feedback</option>
                        <option value="website">Website Feedback</option>
                        <option value="complaint">Complaint</option>
                        <option value="suggestion">Suggestion</option>
                    </select>
                </div>

                <!-- Related Order -->
                <div>
                    <label for="order_id" class="block text-sm font-medium text-gray-700 mb-2">
                        Related Order (Optional)
                    </label>
                    <select id="order_id" 
                            name="order_id" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">Select an order (if applicable)</option>
                        {% for order in orders %}
                        <option value="{{ order.id }}">
                            Order #{{ order.order_number }} - {{ order.created_at|date:"M d, Y" }} (₱{{ order.total }})
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Subject -->
                <div>
                    <label for="subject" class="block text-sm font-medium text-gray-700 mb-2">
                        Subject <span class="text-red-500">*</span>
                    </label>
                    <input type="text" 
                           id="subject" 
                           name="subject" 
                           required
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           placeholder="Brief summary of your feedback">
                </div>

                <!-- Rating -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Overall Rating (Optional)
                    </label>
                    <div class="flex items-center space-x-2">
                        <div class="flex items-center space-x-1" id="rating-stars">
                            <button type="button" class="star-btn text-2xl text-gray-300 hover:text-yellow-400 transition" data-rating="1">
                                <i class="fas fa-star"></i>
                            </button>
                            <button type="button" class="star-btn text-2xl text-gray-300 hover:text-yellow-400 transition" data-rating="2">
                                <i class="fas fa-star"></i>
                            </button>
                            <button type="button" class="star-btn text-2xl text-gray-300 hover:text-yellow-400 transition" data-rating="3">
                                <i class="fas fa-star"></i>
                            </button>
                            <button type="button" class="star-btn text-2xl text-gray-300 hover:text-yellow-400 transition" data-rating="4">
                                <i class="fas fa-star"></i>
                            </button>
                            <button type="button" class="star-btn text-2xl text-gray-300 hover:text-yellow-400 transition" data-rating="5">
                                <i class="fas fa-star"></i>
                            </button>
                        </div>
                        <span id="rating-text" class="text-sm text-gray-500 ml-3">Click to rate</span>
                    </div>
                    <input type="hidden" id="rating" name="rating" value="">
                </div>

                <!-- Message -->
                <div>
                    <label for="message" class="block text-sm font-medium text-gray-700 mb-2">
                        Your Feedback <span class="text-red-500">*</span>
                    </label>
                    <textarea id="message" 
                              name="message" 
                              rows="6" 
                              required
                              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                              placeholder="Please share your detailed feedback. What did you like? What could we improve? Any suggestions?"></textarea>
                </div>

                <!-- Anonymous Option -->
                <div class="flex items-center">
                    <input type="checkbox" 
                           id="is_anonymous" 
                           name="is_anonymous" 
                           class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                    <label for="is_anonymous" class="ml-2 block text-sm text-gray-700">
                        Submit anonymously (your name won't be displayed publicly)
                    </label>
                </div>

                <!-- Guidelines -->
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <div class="flex items-start space-x-3">
                        <i class="fas fa-info-circle text-green-600 mt-1"></i>
                        <div>
                            <h4 class="font-semibold text-green-800 mb-1">Feedback Guidelines:</h4>
                            <ul class="text-sm text-green-700 space-y-1">
                                <li>• Be specific about your experience</li>
                                <li>• Constructive feedback helps us improve</li>
                                <li>• Include suggestions for improvement</li>
                                <li>• Your feedback may be featured on our website (with permission)</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Submit Buttons -->
                <div class="flex items-center justify-between pt-6 border-t">
                    <a href="{% url 'customer_support' %}" 
                       class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition">
                        Cancel
                    </a>
                    
                    <button type="submit" 
                            class="px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition">
                        <i class="fas fa-paper-plane mr-2"></i>
                        Submit Feedback
                    </button>
                </div>
            </form>
        </div>

        <!-- Feedback History -->
        {% if feedback_entries %}
        <div class="mt-8 bg-white rounded-lg shadow-md p-6">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Your Feedback History</h3>
            <div class="space-y-4">
                {% for entry in feedback_entries %}
                <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex flex-wrap items-center justify-between mb-2">
                        <div>
                            <p class="text-lg font-semibold text-gray-900">{{ entry.subject }}</p>
                            <p class="text-xs text-gray-500">Submitted {{ entry.created_at|date:"M d, Y g:i A" }}</p>
                        </div>
                        <span class="px-3 py-1 rounded-full text-xs font-semibold bg-blue-50 text-blue-600">{{ entry.get_feedback_type_display }}</span>
                    </div>
                    <p class="text-sm text-gray-700">{{ entry.message }}</p>
                    <div class="mt-4">
                        {% if entry.admin_response %}
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                <p class="text-sm font-semibold text-yellow-800 mb-1">Admin Response</p>
                                <p class="text-sm text-gray-700">{{ entry.admin_response }}</p>
                                <p class="text-xs text-gray-500 mt-2">Sent {{ entry.responded_at|date:"M d, Y g:i A" }}</p>
                            </div>
                        {% else %}
                            <p class="text-sm text-gray-500 italic">Awaiting admin response</p>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Why Feedback Matters -->
        <div class="mt-8 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-6">
            <h3 class="font-semibold text-gray-800 mb-4 text-center">Why Your Feedback Matters</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center">
                    <div class="bg-green-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-seedling text-green-600"></i>
                    </div>
                    <h4 class="font-medium text-gray-800 mb-2">Improve Quality</h4>
                    <p class="text-sm text-gray-600">Your feedback helps us maintain the highest quality of fresh corn products</p>
                </div>
                
                <div class="text-center">
                    <div class="bg-blue-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-truck text-blue-600"></i>
                    </div>
                    <h4 class="font-medium text-gray-800 mb-2">Better Service</h4>
                    <p class="text-sm text-gray-600">We use your insights to enhance our delivery and customer service</p>
                </div>
                
                <div class="text-center">
                    <div class="bg-yellow-100 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i class="fas fa-lightbulb text-yellow-600"></i>
                    </div>
                    <h4 class="font-medium text-gray-800 mb-2">New Features</h4>
                    <p class="text-sm text-gray-600">Your suggestions inspire new products and website improvements</p>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const starButtons = document.querySelectorAll('.star-btn');
    const ratingInput = document.getElementById('rating');
    const ratingText = document.getElementById('rating-text');
    
    const ratingTexts = {
        1: 'Very Poor',
        2: 'Poor', 
        3: 'Average',
        4: 'Good',
        5: 'Excellent'
    };
    
    starButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const rating = parseInt(this.dataset.rating);
            
            // Update hidden input
            ratingInput.value = rating;
            
            // Update star colors
            starButtons.forEach((star, index) => {
                if (index < rating) {
                    star.classList.remove('text-gray-300');
                    star.classList.add('text-yellow-400');
                } else {
                    star.classList.remove('text-yellow-400');
                    star.classList.add('text-gray-300');
                }
            });
            
            // Update rating text
            ratingText.textContent = ratingTexts[rating];
        });
        
        // Hover effects
        button.addEventListener('mouseenter', function() {
            const rating = parseInt(this.dataset.rating);
            starButtons.forEach((star, index) => {
                if (index < rating) {
                    star.classList.add('text-yellow-300');
                }
            });
        });
        
        button.addEventListener('mouseleave', function() {
            starButtons.forEach(star => {
                star.classList.remove('text-yellow-300');
            });
        });
    });
});
</script>
{% endblock %}
