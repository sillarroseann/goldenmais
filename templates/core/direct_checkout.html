{% extends 'base.html' %}
{% load static %}

{% block title %}Direct Checkout | Golden Mais{% endblock %}

{% block content %}
<!-- Checkout Header -->
<section class="py-12 px-8 bg-orange-50">
    <div class="max-w-4xl mx-auto">
        <div class="flex items-center space-x-2 text-orange-600 mb-2">
            <i class="fas fa-bolt text-xl"></i>
            <h1 class="text-3xl font-bold">Quick Checkout</h1>
        </div>
        <p class="text-gray-600">Complete your purchase in seconds - TikTok style!</p>
    </div>
</section>

<!-- Checkout Content -->
<section class="py-16 px-8">
    <div class="max-w-4xl mx-auto">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Order Summary -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-shopping-bag mr-2 text-orange-600"></i>
                    Your Order
                </h2>
                
                <!-- Product Item -->
                <div class="flex items-center space-x-4 p-4 bg-gray-50 rounded-lg mb-4">
                    <div class="flex-shrink-0">
                        {% if product.image %}
                            <img src="{{ product.image.url }}" alt="{{ product.name }}" 
                                 class="w-16 h-16 object-cover rounded-lg">
                        {% else %}
                            <div class="w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center">
                                <i class="fas fa-image text-gray-400"></i>
                            </div>
                        {% endif %}
                    </div>
                    
                    <div class="flex-1">
                        <h3 class="font-medium text-gray-900">{{ product.name }}</h3>
                        <p class="text-sm text-gray-500">Quantity: {{ quantity }}</p>
                        <p class="text-lg font-semibold text-green-600">₱{{ product.price }} each</p>
                    </div>
                    
                    <div class="text-right">
                        <p class="text-lg font-semibold text-gray-900">₱{{ subtotal }}</p>
                    </div>
                </div>
                
                <!-- Order Totals -->
                <div class="space-y-3 border-t pt-4">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Subtotal</span>
                        <span class="font-medium">₱{{ subtotal }}</span>
                    </div>
                    
                    <div class="flex justify-between">
                        <span class="text-gray-600">Delivery Fee</span>
                        <span class="text-green-600 font-medium" id="delivery-fee-display">FREE</span>
                    </div>
                    
                    <div class="border-t pt-3">
                        <div class="flex justify-between items-center">
                            <span class="text-lg font-semibold text-gray-900">Total</span>
                            <span class="text-lg font-semibold text-orange-600" id="total-display">₱{{ total_pickup }}</span>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="mt-6 p-4 bg-orange-50 rounded-lg">
                    <div class="flex items-center space-x-2 text-orange-800 mb-2">
                        <i class="fas fa-bolt"></i>
                        <span class="font-medium">Quick Checkout Benefits</span>
                    </div>
                    <ul class="text-sm text-orange-700 space-y-1">
                        <li>• Skip cart - direct to checkout</li>
                        <li>• Faster processing</li>
                        <li>• Same-day pickup available</li>
                    </ul>
                </div>
            </div>

            <!-- Checkout Form -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">
                    <i class="fas fa-user mr-2 text-orange-600"></i>
                    Delivery Information
                </h2>
                
                <form method="post" id="checkout-form">
                    {% csrf_token %}
                    
                    <!-- Customer Info -->
                    <div class="space-y-4 mb-6">
                        <div>
                            <label for="phone" class="block text-sm font-medium text-gray-700 mb-2">
                                Phone Number *
                            </label>
                            <input type="tel" id="phone" name="phone" 
                                   value="{{ customer.phone|default:'' }}" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                                   placeholder="09XX XXX XXXX">
                        </div>
                    </div>
                    
                    <!-- Delivery Method -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-3">Delivery Method *</label>
                        <div class="space-y-3">
                            <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="delivery_method" value="pickup" checked 
                                       class="text-orange-600 focus:ring-orange-500" onchange="updateDeliveryFee()">
                                <div class="ml-3 flex-1">
                                    <div class="flex items-center justify-between">
                                        <span class="font-medium text-gray-900">Pickup</span>
                                        <span class="text-green-600 font-medium">FREE</span>
                                    </div>
                                    <p class="text-sm text-gray-500">Golden Mais Farm, Calubian, Leyte</p>
                                </div>
                            </label>
                            
                            <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="delivery_method" value="delivery" 
                                       class="text-orange-600 focus:ring-orange-500" onchange="updateDeliveryFee()">
                                <div class="ml-3 flex-1">
                                    <div class="flex items-center justify-between">
                                        <span class="font-medium text-gray-900">Delivery</span>
                                        <span class="text-gray-600">₱50.00</span>
                                    </div>
                                    <p class="text-sm text-gray-500">Within Calubian, Leyte and nearby areas</p>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Delivery Address -->
                    <div class="mb-6" id="delivery-address-section" style="display: none;">
                        <label for="delivery_address" class="block text-sm font-medium text-gray-700 mb-2">
                            Delivery Address *
                        </label>
                        <textarea id="delivery_address" name="delivery_address" rows="3"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                                  placeholder="Enter your complete delivery address"></textarea>
                    </div>
                    
                    <!-- Payment Method -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-3">Payment Method *</label>
                        <div class="space-y-3">
                            <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="payment_method" value="cash" checked 
                                       class="text-orange-600 focus:ring-orange-500">
                                <div class="ml-3 flex-1">
                                    <div class="flex items-center">
                                        <i class="fas fa-money-bill-wave text-green-600 mr-2"></i>
                                        <span class="font-medium text-gray-900">Cash on Delivery/Pickup</span>
                                    </div>
                                    <p class="text-sm text-gray-500">Pay when you receive your order</p>
                                </div>
                            </label>
                            
                            <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="payment_method" value="gcash" 
                                       class="text-orange-600 focus:ring-orange-500">
                                <div class="ml-3 flex-1">
                                    <div class="flex items-center">
                                        <i class="fas fa-mobile-alt text-blue-600 mr-2"></i>
                                        <span class="font-medium text-gray-900">GCash</span>
                                    </div>
                                    <p class="text-sm text-gray-500">Pay instantly via GCash</p>
                                </div>
                            </label>
                            
                            <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="payment_method" value="bank_transfer" 
                                       class="text-orange-600 focus:ring-orange-500">
                                <div class="ml-3 flex-1">
                                    <div class="flex items-center">
                                        <i class="fas fa-university text-purple-600 mr-2"></i>
                                        <span class="font-medium text-gray-900">Bank Transfer</span>
                                    </div>
                                    <p class="text-sm text-gray-500">Transfer to our bank account</p>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Special Instructions -->
                    <div class="mb-6">
                        <label for="notes" class="block text-sm font-medium text-gray-700 mb-2">
                            Special Instructions (Optional)
                        </label>
                        <textarea id="notes" name="notes" rows="3"
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
                                  placeholder="Any special requests or instructions..."></textarea>
                    </div>
                    
                    <!-- Submit Button -->
                    <button type="submit" id="place-order-btn"
                            class="w-full bg-orange-600 text-white font-semibold py-4 px-6 rounded-lg hover:bg-orange-700 transition text-lg">
                        <i class="fas fa-bolt mr-2"></i>
                        Place Order Now - ₱<span id="final-total">{{ total_pickup }}</span>
                    </button>
                    
                    <!-- Back to Product -->
                    <div class="mt-4 text-center">
                        <a href="{% url 'product_detail' product.slug %}" 
                           class="text-gray-600 hover:text-gray-800 text-sm">
                            <i class="fas fa-arrow-left mr-1"></i>
                            Back to {{ product.name }}
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    // Update delivery fee based on selected method
    function updateDeliveryFee() {
        const deliveryMethod = document.querySelector('input[name="delivery_method"]:checked').value;
        const deliveryFeeDisplay = document.getElementById('delivery-fee-display');
        const totalDisplay = document.getElementById('total-display');
        const finalTotal = document.getElementById('final-total');
        const addressSection = document.getElementById('delivery-address-section');
        const addressInput = document.getElementById('delivery_address');
        
        const subtotal = {{ subtotal }};
        let deliveryFee = 0;
        let total = subtotal;
        
        if (deliveryMethod === 'delivery') {
            deliveryFee = 50;
            total = subtotal + deliveryFee;
            deliveryFeeDisplay.textContent = '₱50.00';
            deliveryFeeDisplay.className = 'text-gray-600 font-medium';
            addressSection.style.display = 'block';
            addressInput.required = true;
        } else {
            deliveryFeeDisplay.textContent = 'FREE';
            deliveryFeeDisplay.className = 'text-green-600 font-medium';
            addressSection.style.display = 'none';
            addressInput.required = false;
        }
        
        totalDisplay.textContent = '₱' + total.toFixed(2);
        finalTotal.textContent = total.toFixed(2);
    }
    
    // Form submission with loading state
    document.getElementById('checkout-form').addEventListener('submit', function(e) {
        const button = document.getElementById('place-order-btn');
        const originalText = button.innerHTML;
        
        button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Processing Order...';
        button.disabled = true;
        
        // Allow form to submit normally
        // The loading state will be visible until page redirects
    });
    
    // Initialize delivery fee calculation
    document.addEventListener('DOMContentLoaded', function() {
        updateDeliveryFee();
    });
</script>
{% endblock %}
